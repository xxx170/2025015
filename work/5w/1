SET SERVEROUTPUT ON;

DECLARE
    -- RECORD 타입 정의
    TYPE studio_record IS RECORD (
        studio_name STUDIO.NAME%TYPE,
        studio_addr STUDIO.ADDRESS%TYPE,
        exec_name MOVIEEXEC.NAME%TYPE,
        exec_addr MOVIEEXEC.ADDRESS%TYPE
    );
    
    -- Associative Array 타입 정의 (인덱스는 영화사 이름)
    TYPE studio_array IS TABLE OF studio_record INDEX BY VARCHAR2(100);
    
    -- Associative Array 변수 선언
    studios studio_array;
    
    -- 반복 변수
    studio_key VARCHAR2(100);
    counter NUMBER := 0;
    
BEGIN
    -- 데이터 로드: STUDIO와 MOVIEEXEC 조인
    FOR rec IN (
        SELECT s.name AS studio_name, 
               s.address AS studio_addr,
               m.name AS exec_name, 
               m.address AS exec_addr
        FROM STUDIO s
        JOIN MOVIEEXEC m ON s.presno = m.certno
        ORDER BY s.name
    ) LOOP
        studios(rec.studio_name).studio_name := rec.studio_name;
        studios(rec.studio_name).studio_addr := rec.studio_addr;
        studios(rec.studio_name).exec_name := rec.exec_name;
        studios(rec.studio_name).exec_addr := rec.exec_addr;
    END LOOP;
    
    -- 헤더 출력
    DBMS_OUTPUT.PUT_LINE(RPAD('순번', 8) || RPAD('영화사', 30) || 
                        RPAD('영화사 주소', 50) || 
                        RPAD('사장', 30) || '사장 주소');
    DBMS_OUTPUT.PUT_LINE(RPAD('-', 150, '-'));
    
    -- Associative Array 내용 출력
    studio_key := studios.FIRST;
    
    WHILE studio_key IS NOT NULL LOOP
        counter := counter + 1;
        
        DBMS_OUTPUT.PUT_LINE(
            RPAD('[' || counter || ']', 8) ||
            RPAD(studios(studio_key).studio_name, 30) ||
            RPAD(studios(studio_key).studio_addr, 50) ||
            RPAD(studios(studio_key).exec_name, 30) ||
            studios(studio_key).exec_addr
        );
        
        studio_key := studios.NEXT(studio_key);
    END LOOP;
    
    DBMS_OUTPUT.PUT_LINE(CHR(10) || '총 ' || counter || '개의 영화사가 출력되었습니다.');
    
END;
/
